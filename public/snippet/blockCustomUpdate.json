[{"id":"20240526211950-n2q5i19","snippet":["//* 在该块中查找可以链接的文本","const matchGroup = input.block.content.match(/(《.*?》)第(.*?)条/);","if (matchGroup) {","  const docTitle = matchGroup[1];","  const num = num2Chinese(matchGroup[2]);","  //*查询法条所在文档","  let body = {","    stmt: `SELECT * FROM blocks WHERE content='${docTitle}' AND type='d'`,","  };","  let res = await fetch(\"http://127.0.0.1:6806/api/query/sql\", {","    body: JSON.stringify(body),","    method: \"POST\",","  });","  const docId = await res.json().then((e) => e.data[0].id);","  //* 查询法条所在块","  body = {","    stmt: `SELECT * FROM blocks WHERE root_id='${docId}' AND content LIKE ' 第${num}%' AND type='l'`,","  };","  res = await fetch(\"http://127.0.0.1:6806/api/query/sql\", {","    body: JSON.stringify(body),","    method: \"POST\",","  });","  const blockId = await res.json().then((e) => e.data[0].id);","  //* 生成链接并更新块","  const link = `((${blockId} \"${matchGroup[0]}\"))`;","  output = output.replace(matchGroup[0], link);","}","//数字转中文，仅支持到千，对于法条来说够用了","function num2Chinese(num) {","  const chnNumChar = [","    \"零\",","    \"一\",","    \"二\",","    \"三\",","    \"四\",","    \"五\",","    \"六\",","    \"七\",","    \"八\",","    \"九\",","  ];","  const unit = [\"千\", \"百\", \"十\", \"\"];","  const unitLength = 4;","  const text = num + \"\";","  const list = text.split(\"\");","  while (list.length < 4) {","    list.unshift(\"0\");","  }","  let subResultList = [];","  for (let i = list.length - 1; i >= 0; i--) {","    if (list[i] !== \"0\") {","      subResultList.unshift(chnNumChar[list[i]] + unit[i]);","    } else {","      subResultList.unshift(\"零\");","    }","  }","  let result = subResultList.join(\"\");","  //*去除多余的零","  while (result.search(\"零零\") !== -1) {","    result = result.replace(/零零/g, \"零\");","  }","  result = result.replace(/^零/, \"\");","  result = result.replace(/零$/, \"\");","  return result;","}","",""],"name":"法条自动链接"}]